<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Server | 天下]]></title>
  <link href="http://githubch.github.io/blog/categories/server/atom.xml" rel="self"/>
  <link href="http://githubch.github.io/"/>
  <updated>2014-10-31T11:39:14+08:00</updated>
  <id>http://githubch.github.io/</id>
  <author>
    <name><![CDATA[宏]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Sql 2008 Restore Database With Cluster]]></title>
    <link href="http://githubch.github.io/blog/2014/10/31/sql-2008-restore-database-with-cluster/"/>
    <updated>2014-10-31T11:30:52+08:00</updated>
    <id>http://githubch.github.io/blog/2014/10/31/sql-2008-restore-database-with-cluster</id>
    <content type="html"><![CDATA[<p>Error: &lsquo;Cannot use file &rsquo;<path>.mdf&#8217; for clustered server. Only formatted files on which the cluster resource of the server has a dependency can be used</p>

<p>Skip to end of metadata Go to start of metadata
KB# 3337</p>

<p>SYMPTOM:</p>

<p>When attempting to restore to a SQL Server cluster, you get an error like the following:</p>

<p>Server instance: SQLCLUSTER, Database: Database</p>

<p>Msg 5184, Level 16, State 2, Server SQLCLUSTER, Line 1</p>

<p>Cannot use file &rsquo;M:\MSSQL.1\MSSQL\SQLDataFiles\Database_Data.mdf&#8217; for clustered server. Only formatted files on which the cluster resource of the server has a dependency can be used.</p>

<p>Msg 3156, Level 16, State 3, Server SQLCLUSTER, Line 1</p>

<p>File &lsquo;Database&rsquo; cannot be restored to &rsquo;M:\MSSQL.1\MSSQL\SQLDataFiles\Database_Data.mdf&#8217;. Use WITH MOVE to identify a valid location for the file.</p>

<p>Msg 3119, Level 16, State 1, Server SQLCLUSTER, Line 1</p>

<p>Problems were identified while planning for the RESTORE statement. Previous messages provide details.</p>

<p>Msg 3013, Level 16, State 1, Server SQLCLUSTER, Line 1</p>

<p>RESTORE DATABASE is terminating abnormally.</p>

<p>CAUSE:</p>

<p>The restore is failing because attempts are being made to place the .mdf and .ldf files on a drive which is not a drive the cluster resource group is dependent upon. SQL Server requires that all of its database files exist on drives where the cluster resource group is dependent.</p>

<p>SOLUTION:</p>

<p>Either of the following steps should resolve the issue:</p>

<ol>
<li>Add a dependency on this drive to the cluster resource group.</li>
</ol>


<p>Here is a Microsoft link that describes this issue and how to add a cluster dependency: <a href="http://support.microsoft.com/kb/295732">http://support.microsoft.com/kb/295732</a></p>

<p>OR</p>

<ol>
<li>Specify WITH MOVE during the restore operation to restore these files to a drive that the cluster is dependent upon.</li>
</ol>


<p>If you wish to move the data and log files to a drive that is already configured as a cluster resource drive, you can use the WITH MOVE parameter in the restore command.</p>

<p>If you are performing the restore from the SQL Safe Management Console, you can simply type in the new path for these files in the ‘Restore database files as’ field labeled ‘Change Path.’ Hit Apply and you will see that the target files have been updated with the new path. This will add the WITH MOVE T-SQL statement to the restore job.</p>

<p>If you are using the command line or the SQL Safe Extended Stored Procedures to perform this restore, then you will want to use the –move or @move parameter, respectively, to change the destination for these files to a drive which the SQL Server instance can use.</p>
]]></content>
  </entry>
  
</feed>
